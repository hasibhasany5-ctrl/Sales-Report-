<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART Analytics | Nugortech IT Ltd</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --p: #FF6B00; --b: #00A3FF; --s: #10b981; --d: #f43f5e; --bg: #0b0f19; --glass: rgba(255, 255, 255, 0.03); }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { margin: 0; background: var(--bg); color: white; display: flex; min-height: 100vh; overflow-x: hidden; }
        .sidebar { width: 260px; background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border-right: 1px solid rgba(255,255,255,0.1); padding: 40px 25px; position: fixed; height: 100vh; z-index: 100; }
        .main { margin-left: 260px; width: calc(100% - 260px); padding: 40px; }
        .stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .card { padding: 25px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; }
        .c-1 { background: #007bff; } .c-2 { background: #fd7e14; } .c-3 { background: #6f42c1; } .c-4 { background: #28a745; }
        .val { font-size: 24px; font-weight: 800; display: block; } .lbl { font-size: 9px; font-weight: 700; text-transform: uppercase; opacity: 0.8; }
        .glass-panel { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); padding: 30px; border-radius: 30px; backdrop-filter: blur(10px); }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { padding: 12px; font-size: 9px; color: #64748b; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; background: #0b0f19; }
        td { padding: 15px 12px; border-bottom: 1px solid rgba(255,255,255,0.03); font-weight: 600; font-size: 13px; }
        .badge-call { background: rgba(16, 185, 129, 0.2); color: #00E676; padding: 4px 8px; border-radius: 8px; font-size: 11px; }
        .badge-late { background: #f43f5e; color: white; padding: 4px 8px; border-radius: 8px; font-size: 11px; }
        input { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 12px; border-radius: 12px; color: white; outline: none; margin-bottom: 20px; width: 100%; }
        .btn { padding: 10px 20px; border-radius: 12px; border: none; cursor: pointer; font-weight: 700; color: white; }
    </style>
</head>
<body>
<div class="sidebar">
    <h2 style="margin:0; font-weight:800; color: #00A3FF;">NUGORTECH IT</h2>
    <p style="color:var(--p); font-size:9px; font-weight:800; letter-spacing:1px; text-transform: uppercase;">Smart Sales Console</p>
    <div style="margin-top: 50px; font-weight: 800; color: #00A3FF;"><i class="fas fa-chart-line"></i> ANALYTICS</div>
</div>
<div class="main">
    <div class="stat-grid">
        <div class="card c-1"><span class="val" id="v1">৳0</span><span class="lbl">Filtered Sales</span></div>
        <div class="card c-2"><span class="val" id="v2">৳0</span><span class="lbl">Filtered Due</span></div>
        <div class="card c-3"><span class="val" id="v3">৳0</span><span class="lbl">5% Comm.</span></div>
        <div class="card c-4"><span class="val" id="v4">0</span><span class="lbl">Total Leads</span></div>
    </div>
    <div class="glass-panel">
        <div style="display: flex; gap:15px;">
            <input type="text" id="sName" placeholder="Search by Name/ID..." onkeyup="updateUI()">
            <input type="text" id="sDate" placeholder="Search by Date (e.g. 28-02-2026)" onkeyup="updateUI()">
            <button class="btn" style="background:var(--d); height: 45px;" onclick="wipeData()"><i class="fas fa-trash"></i></button>
        </div>
        <div style="display: grid; grid-template-columns: 2.2fr 1fr; gap: 25px;">
            <div style="max-height: 450px; overflow-y: auto;">
                <table id="mainT">
                    <thead><tr><th>Date</th><th>Name</th><th>ID</th><th>Sales</th><th>Old Calls</th><th>Status</th><th>Del</th></tr></thead>
                    <tbody id="tbody"></tbody>
                </table>
            </div>
            <div style="text-align:center;">
                <h4 style="font-size: 11px; opacity: 0.6; text-transform: uppercase;">Employee Summary</h4>
                <div style="max-height: 200px; overflow-y: auto;">
                    <table style="font-size: 11px;">
                        <thead><tr><th>Name</th><th>Sales</th><th>Comm.</th></tr></thead>
                        <tbody id="nameBody"></tbody>
                    </table>
                </div>
                <canvas id="myChart" style="margin-top: 20px;"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyBrz1xvq4Fpt9-j75-gUS4d8ebqPRLmOK0", authDomain: "sales-report-nugortech-it.firebaseapp.com", databaseURL: "https://sales-report-nugortech-it-default-rtdb.firebaseio.com", projectId: "sales-report-nugortech-it", appId: "1:848643315031:web:e6fbf92153490ea9d31a12" };
    firebase.initializeApp(firebaseConfig); const database = firebase.database();
    let masterData = [], pieChart;

    database.ref('sales_reports').on('value', snap => {
        const data = snap.val(); masterData = [];
        if (data) Object.keys(data).forEach(k => masterData.push({ key: k, ...data[k] }));
        updateUI();
    });

    function updateUI() {
        const sn = document.getElementById('sName').value.toUpperCase(), sd = document.getElementById('sDate').value.toUpperCase(), tb = document.getElementById('tbody'), nb = document.getElementById('nameBody');
        tb.innerHTML = ""; nb.innerHTML = "";
        let fS = 0, fD = 0, fC = 0, fL = 0, sm = {};

        const filtered = masterData.filter(d => (d.name.toUpperCase().includes(sn) || d.id.includes(sn)) && d.date.toUpperCase().includes(sd)).reverse();

        filtered.forEach(d => {
            const s = Number(d.sales||0), du = Number(d.due||0), l = Number(d.lead||0), c = s * 0.05, calls = d.oldCalls || 0;
            fS += s; fD += du; fC += c; fL += l;
            if(!sm[d.name]) sm[d.name] = {s:0, c:0}; sm[d.name].s += s; sm[d.name].c += c;

            tb.innerHTML += `<tr>
                <td>${d.date}</td><td>${d.name}</td><td>#${d.id}</td>
                <td>৳${s.toLocaleString()}</td>
                <td><span class="badge-call">${calls} Calls</span></td>
                <td>${d.attendanceStatus === "Late" ? '<span class="badge-late">LATE</span>' : 'ON TIME'}</td>
                <td><button onclick="delOne('${d.key}')" style="background:none; border:none; color:red; cursor:pointer;"><i class="fas fa-trash-alt"></i></button></td>
            </tr>`;
        });

        Object.keys(sm).forEach(n => nb.innerHTML += `<tr><td>${n}</td><td>৳${sm[n].s.toLocaleString()}</td><td>৳${sm[n].c.toLocaleString()}</td></tr>`);
        document.getElementById('v1').innerText = "৳" + fS.toLocaleString();
        document.getElementById('v2').innerText = "৳" + fD.toLocaleString();
        document.getElementById('v3').innerText = "৳" + fC.toLocaleString();
        document.getElementById('v4').innerText = fL;
        updateChart(fS, fD);
    }

    function updateChart(s, d) {
        const ctx = document.getElementById('myChart').getContext('2d'); if (pieChart) pieChart.destroy();
        pieChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Paid', 'Due'], datasets: [{ data: [s-d, d], backgroundColor: ['#28a745', '#fd7e14'], borderWidth: 0 }] }, options: { maintainAspectRatio: false, cutout: '80%', plugins: { legend: { position: 'bottom', labels: { color: '#94a3b8', font: {size: 10} } } } } });
    }

    function delOne(k) { if(prompt("Pass?") === "8087") database.ref('sales_reports/'+k).remove(); }
    function wipeData() { if(prompt("Master Pass?") === "8087") database.ref('sales_reports').remove(); }
</script>
</body>
</html>
